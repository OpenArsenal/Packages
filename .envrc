# .envrc
#
# This file is evaluated by direnv *using bash* (even if your interactive shell is fish).
# That matters because it means we can safely use bash features inside this file.
#
# Why we use direnv at all:
# - We want makepkg (and tools that call it, like paru) to *automatically* route outputs
#   into our local repo directory.
# - We *do not* want to globally rewrite /etc/makepkg.conf, because that leaks project
#   assumptions into the whole system and makes debugging harder.
# - direnv gives “project-scoped env vars” that follow you as you cd around.

# ------------------------------
# Root of your PKGBUILD collection
# ------------------------------
#
# IMPORTANT: We intentionally *do not* use PKGBUILDS_ROOT="$PWD".
# Reason:
# - direnv loads this file not only in the repo root, but also when you cd into
#   subdirectories. If we used $PWD, then PKGDEST/SRCDEST/BUILDDIR would “move around”
#   depending on which package folder you’re currently in.
#
# Using BASH_SOURCE[0] pins the root to “where .envrc lives”, which is what we want.
export PKGBUILDS_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd -P)"

# ------------------------------
# Target architecture directory
# ------------------------------
#
# We keep the repo layout compatible with pacman’s $arch convention.
# - makepkg often sets CARCH internally, but it’s not always exported into your shell.
# - fallback to uname -m so local builds land in the correct folder.
export PKG_REPO_ARCH="${CARCH:-$(uname -m)}"

# ------------------------------
# Repository output (served to pacman)
# ------------------------------
#
# PKGDEST:
# - This is the *single most important* variable here.
# - makepkg will copy final *.pkg.tar.* artifacts into this directory.
# - If pacman is pointed at this directory as a repo, then local packages become
#   first-class citizens: installable via pacman/paru without pacman -U paths.
export PKGDEST="$PKGBUILDS_ROOT/.repo/$PKG_REPO_ARCH"

# SRCPKGDEST:
# - Where “source packages” land (makepkg --source).
# - Useful if you want to archive or publish source tarballs separately.
export SRCPKGDEST="$PKGBUILDS_ROOT/.repo/src"

# ------------------------------
# Build / cache separation
# ------------------------------
#
# These keep your workspace clean and reduce “why is my git status dirty?” pain.
# Also: when you delete caches you don’t nuke built repo artifacts.
#
# SRCDEST:
# - Where downloaded sources live (tarballs, git clones, etc.)
# - Shared across packages speeds up builds (less re-downloading).
export SRCDEST="$PKGBUILDS_ROOT/.cache/makepkg/src"

# BUILDDIR:
# - Where compilation/build trees live.
# - Keeping it centralized avoids per-package build junk and makes cleanup easier.
export BUILDDIR="$PKGBUILDS_ROOT/.cache/makepkg/build"

# LOGDEST:
# - Centralized logs make failures easier to inspect without hunting through folders.
export LOGDEST="$PKGBUILDS_ROOT/.cache/makepkg/log"

# ------------------------------
# Identity / signing
# ------------------------------
#
# PACKAGER:
# - Only affects metadata inside the package.
# - Helpful for tracing where a package came from in a multi-maintainer setup.
export PACKAGER="OpenArsenal Contributors <arch-packaging-team(at)openarsenal(dot)com>"

# GPGKEY (optional):
# - Only needed if you’re signing packages or the repo db.
# - Avoid committing real key IDs if the repo is public.
# export GPGKEY="YOURKEYID"

# GNUPGHOME:
# - Usually best to NOT override. Use your normal keyring.
# - Only override if you *intentionally* want a repo-local keyring (rare).
# export GNUPGHOME="$HOME/.gnupg"
export GNUPGHOME="$PKGBUILDS_ROOT/.gnupg"

# ------------------------------
# Optional overrides
# ------------------------------
# Reproducible builds
export SOURCE_DATE_EPOCH="$(date -u +%s)"

# MAKEPKG_LINT_PKGBUILD:
# - Only disable linting if you’ve decided speed > guardrails.
# - Otherwise keep default: lint catches common packaging mistakes early.
# export MAKEPKG_LINT_PKGBUILD=0
