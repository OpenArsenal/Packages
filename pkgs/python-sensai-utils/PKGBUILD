# Maintainer: Carl <you@example.com>
# Upstream: https://github.com/oraios/sensAI-utils
# PyPI: https://pypi.org/project/sensai-utils/

pkgname=python-sensai-utils
_pkgname=sensai-utils
pkgver=1.6.0
pkgrel=1
pkgdesc="Utilities from sensAI, the Python library for sensible AI"
arch=('any')
url="https://pypi.org/project/sensai-utils/"
license=('MIT')

depends=(
  'python'
  'python-typing_extensions'
)

makedepends=(
  'python-build'
  'python-installer'
  'python-wheel'
  'python-setuptools'
  'python-setuptools-scm'
)

# PyPI sdist for 1.6.0 (hash from PyPI)
# (Filename uses underscore: sensai_utils-1.6.0.tar.gz) :contentReference[oaicite:4]{index=4}
source=(
  "sensai_utils-${pkgver}.tar.gz::https://pypi.io/packages/source/s/${_pkgname}/sensai_utils-${pkgver}.tar.gz"
)

sha256sums=(
  'e50ae6bbd7c62a961f25b98e55b29029450efd66444678931b3b9c43e9bf9e95'
)

prepare() {
  cd "${srcdir}/sensai_utils-${pkgver}"

  # Upstream sdist appears to omit requirements.txt, but setup.py reads it during
  # PEP 517 build-requires discovery. Provide the minimal requirement that maps
  # to our Arch runtime dep.
  if [[ ! -f requirements.txt ]]; then
    printf '%s\n' 'typing-extensions>=4.6' > requirements.txt
  fi
}

build() {
  cd "${srcdir}/sensai_utils-${pkgver}"
  python -m build --wheel --no-isolation
}

package() {
  cd "${srcdir}/sensai_utils-${pkgver}"
  python -m installer --destdir="${pkgdir}" dist/*.whl

  install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
